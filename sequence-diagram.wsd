@startuml

skinparam boxPadding 10
skinparam ParticipantPadding 20
skinparam Shadowing false

box "ðŸ‘¤ Cliente" #D0E7FF
  actor Cliente
end box

box "ðŸ–¥ï¸ Sistema (Interface)" #E8E8E8
  participant Sistema
end box

box "âš™ï¸ Services" #F9F9F9
  participant CadastroService
  participant LocacaoService
  participant PromocaoService
  participant PagamentoService
  participant MultaService
end box

Cliente -> Sistema : iniciarSolicitacaoLocacao(codCliente, categoriaDesejada)
activate Sistema

' --- VerificaÃ§Ã£o de Cadastro ---
Sistema -> CadastroService : buscarCadastro(codCliente)
activate CadastroService
alt Cadastro inexistente
    CadastroService --> Sistema : null
    deactivate CadastroService
    Sistema -> Cliente : "Cadastro nÃ£o encontrado. FaÃ§a o registro."
    deactivate Sistema
    return
else Cadastro encontrado
    CadastroService --> Sistema : dadosCliente
    deactivate CadastroService
end

' --- VerificaÃ§Ã£o de PendÃªncias ---
Sistema -> CadastroService : verificarLocacoesPendentes(codCliente)
activate CadastroService
alt Possui pendÃªncias
    CadastroService --> Sistema : pendencias = true
    deactivate CadastroService
    Sistema -> Cliente : "LocaÃ§Ãµes pendentes. NÃ£o Ã© possÃ­vel alugar."
    deactivate Sistema
    return
else Sem pendÃªncias
    CadastroService --> Sistema : pendencias = false
    deactivate CadastroService
end

' --- CriaÃ§Ã£o da LocaÃ§Ã£o ---
Sistema -> LocacaoService : criarLocacao(codCliente, categoria)
activate LocacaoService
LocacaoService --> Sistema : locacaoId
deactivate LocacaoService

' --- Aplicar PromoÃ§Ãµes ---
Sistema -> PromocaoService : verificarPromocao(locacaoId)
activate PromocaoService
PromocaoService --> Sistema : desconto, upgrade
deactivate PromocaoService

' --- Processar Pagamento ---
Sistema -> PagamentoService : calcularReserva(valor, desconto)
Sistema -> Cliente : solicitarDadosPagamento()
Cliente -> Sistema : enviarDadosPagamento()
Sistema -> PagamentoService : processarPagamento(dados)
activate PagamentoService
alt Pagamento recusado
    PagamentoService --> Sistema : status = "falha"
    deactivate PagamentoService
    Sistema -> Cliente : "Pagamento recusado"
    deactivate Sistema
    return
else Pagamento aprovado
    PagamentoService --> Sistema : status = "ok"
    deactivate PagamentoService
end

' --- Verificar Multas ---
Sistema -> MultaService : consultarMultas(veiculo)
activate MultaService
MultaService --> Sistema : listaMultas
deactivate MultaService
Sistema -> Cliente : notificarMultas(listaMultas)

' --- Finalizar LocaÃ§Ã£o ---
Sistema -> LocacaoService : concluirLocacao(locacaoId, valorFinal)
Sistema -> Cliente : locacaoConfirmada()

deactivate Sistema
@enduml
